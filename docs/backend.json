{
  "entities": {
    "Cave": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Cave",
      "type": "object",
      "description": "Represents a cave in the application.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the cave."
        },
        "name": {
          "type": "string",
          "description": "The name of the cave."
        },
        "coverImage": {
          "type": "string",
          "description": "URL of the cover image for the cave."
        },
        "isActive": {
          "type": "boolean",
          "description": "Indicates whether the cave is currently active and available."
        }
      },
      "required": [
        "id",
        "name",
        "coverImage",
        "isActive"
      ]
    },
    "Spot": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Spot",
      "type": "object",
      "description": "Represents a spot within a cave.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the spot."
        },
        "caveId": {
          "type": "string",
          "description": "Reference to the Cave entity. (Relationship: Cave 1:N Spot)"
        },
        "order": {
          "type": "number",
          "description": "The order of the spot within the cave."
        },
        "title": {
          "type": "string",
          "description": "The title of the spot."
        },
        "description": {
          "type": "string",
          "description": "A description of the spot."
        },
        "imageUrl": {
          "type": "string",
          "description": "URL of the image for the spot."
        },
        "isPro": {
          "type": "boolean",
          "description": "Indicates whether the spot is a PRO spot."
        },
        "effects": {
          "type": "string",
          "description": "A JSON string of vibration effect configuration."
        },
        "hotspots": {
          "type": "array",
          "description": "An array of hotspots for navigation within a 3D view.",
          "items": {
            "$ref": "#/entities/Hotspot"
          }
        }
      },
      "required": [
        "id",
        "caveId",
        "order",
        "title",
        "description",
        "imageUrl",
        "isPro",
        "effects"
      ]
    },
    "Hotspot": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Hotspot",
      "type": "object",
      "description": "Represents a navigation point within a 3D spot.",
      "properties": {
        "id": {
          "type": "string"
        },
        "label": {
          "type": "string"
        },
        "position": {
          "type": "array",
          "items": {
            "type": "number"
          }
        },
        "targetSpotId": {
          "type": "string"
        }
      },
      "required": ["id", "label", "position", "targetSpotId"]
    },
    "User": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "User",
      "type": "object",
      "description": "Represents a user of the application.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the user (Firebase UID)."
        },
        "role": {
          "type": "string",
          "description": "The user's role (free, pro, admin).",
          "format": "string"
        },
        "displayName": {
          "type": "string",
          "description": "The user's display name."
        },
        "email": {
          "type": "string",
          "description": "The user's email address.",
          "format": "email"
        },
        "photoURL": {
          "type": "string",
          "description": "The URL of the user's profile photo.",
          "format": "uri"
        },
        "updatedAt": {
          "type": "string",
          "description": "The timestamp when the user's information was last updated.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "role",
        "displayName",
        "email",
        "updatedAt"
      ]
    },
    "Artifact": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Artifact",
      "type": "object",
      "description": "Represents a discoverable artifact within a cave.",
      "properties": {
        "id": {
          "type": "string"
        },
        "caveId": {
          "type": "string",
          "description": "The cave where this artifact is located."
        },
        "spotId": {
          "type": "string",
          "description": "The specific spot where this artifact is hidden."
        },
        "name": {
          "type": "string"
        },
        "description": {
          "type": "string"
        },
        "imageUrl": {
          "type": "string"
        }
      },
      "required": ["id", "caveId", "spotId", "name", "description", "imageUrl"]
    },
    "UserArtifact": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "UserArtifact",
      "type": "object",
      "description": "Links a user to an artifact they have found.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Same as the artifactId."
        },
        "userId": {
          "type": "string"
        },
        "caveId": {
          "type": "string"
        },
        "foundAt": {
          "type": "string",
          "format": "date-time"
        }
      },
      "required": ["id", "userId", "caveId", "foundAt"]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous",
      "google.com"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/caves/{caveId}",
        "definition": {
          "entityName": "Cave",
          "schema": {
            "$ref": "#/backend/entities/Cave"
          },
          "description": "Stores information about caves. Publicly readable.",
          "params": [
            {
              "name": "caveId",
              "description": "Unique identifier for the cave."
            }
          ]
        }
      },
      {
        "path": "/caves/{caveId}/spots/{spotId}",
        "definition": {
          "entityName": "Spot",
          "schema": {
            "$ref": "#/backend/entities/Spot"
          },
          "description": "Stores information about spots within a cave. Publicly readable. `caveId` is denormalized to maintain the relationship.",
          "params": [
            {
              "name": "caveId",
              "description": "Unique identifier for the cave."
            },
            {
              "name": "spotId",
              "description": "Unique identifier for the spot."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}",
        "definition": {
          "entityName": "User",
          "schema": {
            "$ref": "#/backend/entities/User"
          },
          "description": "Stores user profile information, including role (free, pro, admin). Only the authenticated user can read/write their own document.",
          "params": [
            {
              "name": "userId",
              "description": "The Firebase UID of the user."
            }
          ]
        }
      },
      {
        "path": "/artifacts/{artifactId}",
        "definition": {
          "entityName": "Artifact",
          "schema": { "$ref": "#/backend/entities/Artifact" },
          "description": "Master list of all discoverable artifacts. Publicly readable."
        }
      },
      {
        "path": "/users/{userId}/artifacts/{artifactId}",
        "definition": {
          "entityName": "UserArtifact",
          "schema": { "$ref": "#/backend/entities/UserArtifact" },
          "description": "Stores artifacts found by a specific user. Only the user can write to their own subcollection."
        }
      }
    ],
    "reasoning": "The Firestore data structure is designed to support the \"Cave Explorer 4D\" application, focusing on mobile-first experience, 4D digital immersion (audio, haptics, visuals), and FREE/PRO access control. The structure prioritizes authorization independence using denormalization and structural segregation. It avoids `get()` calls in security rules to enable atomic operations. All read operations are public, so rules act only as validators, and never as filters (QAPs). The structure supports the core app features including listing caves and spots, immersive spot experiences, haptic feedback, Google Authentication, access control based on user roles, and personalized ambience. The addition of Artifacts and UserArtifacts collections supports the new gamification feature, allowing users to collect items and view them in their profile."
  }
}
